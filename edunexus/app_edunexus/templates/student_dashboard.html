{% extends "base_dashboard.html" %}
{% load static %}

{% block title %}
Edunexus - Student Dashboard
{% endblock %}
{% block css %}
<link rel="stylesheet" href="https://res.cloudinary.com/duhg4tvty/raw/upload/v1756632311/student_dashboard_gqj4pn.css">
{% endblock %}


{% block nav_right %}
ðŸ‘¤ Welcome
{% endblock %}

{% block sidebar %}

<li><a href="{% url 'Student_Dashboard' %}" class="capsule"><i class="fa fa-home me-2"></i> Dashboard</a></li>
<li><a href="{% url 'my_profile' %}" class="capsule"><i class="fa fa-home me-2"></i> My Profile</a></li>
<li><a href="{% url 'announcement_list' %}" class="capsule" style="cursor: pointer;"><i class="fa-solid fa-bullhorn"></i>
    Announcements</a></li>
<li><a href="{% url 'notice_list' %}" class="capsule" style="cursor: pointer;"><i class="fa-solid fa-bell"></i>
    Notice</a></li>
<li><a href="{% url 'ebook_list_student' %}" class="capsule"><i class="fa fa-calendar me-2"></i>E-Library</a></li>
<li><a href="{% url 'help_section' %}" class="capsule"><i class="fa fa-question-circle" aria-hidden="true"></i> Help</a>
<li><a href="{% url 'log_out' %}" class="capsule"><i class="fa fa-sign-out" aria-hidden="true"></i> Log Out</a>
</li>
{% endblock %}

{% block main %}
<section class="container mt-4">

    {% if form %}
    <!-- Student Profile Form -->
    <div class="card p-4" style="max-width:600px; margin:auto;">
        <h3 class="mb-3 text-center">Fill Your Profile</h3>
        <form action="{% url 'Student_Dashboard' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="mb-3">
                {{ form.name.label_tag }}
                {{ form.name }}
                {% if form.name.errors %}
                <div class="text-danger">{{ form.name.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                {{ form.profile_image.label_tag }}
                {{ form.profile_image }}
                {% if form.profile_image.errors %}
                <div class="text-danger">{{ form.profile_image.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                {{ form.course.label_tag }}
                {{ form.course }}
                {% if form.course.errors %}
                <div class="text-danger">{{ form.course.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                {{ form.roll_number.label_tag }}
                {{ form.roll_number }}
                {% if form.roll_number.errors %}
                <div class="text-danger">{{ form.roll_number.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                {{ form.year.label_tag }}
                {{ form.year }}
                {% if form.year.errors %}
                <div class="text-danger">{{ form.year.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                {{ form.department.label_tag }}
                {{ form.department }}
                {% if form.department.errors %}
                <div class="text-danger">{{ form.department.errors.0 }}</div>
                {% endif %}
            </div>


            <button type="submit" class="btn btn-success w-100">Submit Profile</button>
        </form>
    </div>
    {% endif %}


    {% if dashboard %}
    <!-- Dashboard Content -->

    <div class="container-fluid px-4">
        <h2 class="mt-4">Student <span style="color:#007777;">Dashboard</span></h2>

        <!-- Top Cards -->
       <div class="row mt-4">
    <!-- Course Card -->
    <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <div class="card shadow-sm border-6 text-center h-100" style="border-top:4px solid #007777;">
            <div class="card-body">
                <h5 class="text-muted">Course</h5>
                <h3 class="fw-bold" style="color:#007777;">{{ data.course }}</h3>
            </div>
        </div>
    </div>

    <!-- Department Card -->
    <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <div class="card shadow-sm border-6 text-center h-100" style="border-top:4px solid #007777;">
            <div class="card-body">
                <h5 class="text-muted">Department</h5>
                <h3 class="fw-bold" style="color:#007777;">{{ data.department }}</h3>
            </div>
        </div>
    </div>

    <!-- Year Card -->
    <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <div class="card shadow-sm border-6 text-center h-100" style="border-top:4px solid #007777;">
            <div class="card-body">
                <h5 class="text-muted">Year</h5>
                <h3 class="fw-bold" style="color:#007777;">{{ data.year }}</h3>
            </div>
        </div>
    </div>
</div>

        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body">
                        <h5 style="color:#007777;">Quick Actions</h5>
                        <div class="d-flex flex-wrap gap-2">
                            <a href="{% url 'my_profile' %}" class="btn w-auto"
                                style="background:#007777; color:white;">My Profile</a>
                            <a href="{% url 'ebook_list_student' %}" class="btn w-auto"
                                style="background:#007777; color:white;">E-Library</a>
                            <a href="{% url 'announcement_list' %}" class="btn w-auto"
                                style="background:#007777; color:white;">Announcements</a>
                            <a href="{% url 'notice_list' %}" class="btn w-auto"
                                style="background:#007777; color:white;">Notices</a>
                            <a href="{% url 'help_section' %}" class="btn w-auto" style="background:#007777; color:white;">Contact</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Subjects Table -->
        <div class="row mt-4">
    <div class="col-md-12">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h5 style="color:#007777;">My Department</h5>
                <!-- Responsive Wrapper -->
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead class="table-light">
                            <tr>
                                <th>Department</th>
                                <th>Code</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{ data.department.name }}</td>
                                <td>{{ data.department.code }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- End Responsive Wrapper -->
            </div>
        </div>
    </div>
</div>


    </div>

    {% endif %}

    {% if my_profile_card %}

    <div class="card profile-card p-4 shadow-lg border-0 rounded-3 mt-4"
        style="max-width: 750px; margin:auto; border-top: 5px solid #007777;">
        <div class="row g-3 align-items-center text-center text-md-start">

            <!-- Profile Image -->
            <div class="col-12 col-md-4">
                <img src="{{ data.profile.url }}" alt="Profile Photo" class="img-fluid rounded-circle shadow-sm"
                    style="width: 150px; height: 150px; object-fit: cover; border: 3px solid #007777;">
            </div>

            <!-- Profile Details -->
            <div class="col-12 col-md-8">
                <div class="card-body">
                    <h4 class="card-title mb-2" style="color:#007777;">{{ data.name }}</h4>
                    <p class="text-muted mb-1"><b>Branch:</b> {{ data.department }}</p>
                    <p class="text-muted mb-1"><b>Roll No:</b> {{ data.roll_no }}</p>
                    <p class="text-muted mb-1"><b>Year:</b> {{ data.year }}</p>
                    <p class="text-muted mb-1"><b>Email:</b> {{ data.email }}</p>
                    <p class="text-muted mb-0"><b>Contact:</b> {{ data.contact }}</p>
                    <a href="{% url 'edit_my_profile' pk=data.profile_id %}" class="btn edit-btn mt-2 px-4">Edit
                        Profile</a>
                </div>
            </div>
        </div>
</section>

{% endif %}

{% if my_profile_edit_form %}
<div class="card p-4 shadow-lg border-0 rounded-3 mt-4"
    style="max-width:700px; margin:auto; border-top:5px solid #007777;">
    <h4 class="mb-3" style="color:#007777;">Edit Profile</h4>
    <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        {{ my_profile_edit_form.as_p }}
        <button type="submit" class="btn btn-success px-4">Update</button>
        <a href="{% url 'my_profile' %}" class="btn btn-secondary px-4 ms-2">Cancel</a>
    </form>
</div>
{% endif %}


{% if ebook_list %}
<div class="container-fluid py-3">
    <div class="d-flex align-items-center mb-3">
        <h4 class="mb-0"><span class="brand-text" style="color:#007777;">Student</span></h4>
    </div>
    <div class="d-flex justify-content-end mb-3">
        <a href="{% url 'read_later_list' %}" class="btn btn-warning">
            Read Later ({{ read_later_length }})
        </a>
    </div>
</div>

<div class="table-container" style="max-width:1200px; margin:auto;">
    <!-- Header -->
    <!-- Header -->
  <div class="table-header d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3">
    <h3 class="mb-2 mb-md-0" style="color:#007777;">Ebooks</h3>
    <form method="GET" class="d-flex flex-column flex-sm-row w-md-auto">
      <input type="text" 
             name="search" 
             placeholder="Search Ebooks..." 
             class="form-control me-sm-2 mb-2 mb-sm-0"
             value="{{ search_query }}">
      <button type="submit" class="btn btn-primary  w-sm-auto">Search</button>
    </form>
  </div>
    <!-- Ebooks Table (Responsive Wrapper Added) -->
    <div class="table-responsive">
        <table class="table align-middle table-hover" 
               style="border-collapse: separate; border-spacing: 0 8px;">
            <thead style="background-color:#007777; color:#fff; border-radius:8px;">
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>File</th>
                    <th>Uploaded At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for book in ebooks %}
                <tr>
                    <td>{{ book.title }}</td>
                    <td>{{ book.description }}</td>
                    <td>
                        <a href="{{ book.file.url }}" target="_blank" class="btn btn-primary btn-sm">
                            <i class="bi bi-book"></i> Read
                        </a>
                    </td>
                    <td>{{ book.uploaded_at }}</td>
                    <td>
                        <a href="{% url 'toggle_read_later' pk=book.id %}" class="btn btn-info btn-sm">
                            {% if book.id in read_later_ids %}
                            Remove from Read Later
                            {% else %}
                            Add to Read Later
                            {% endif %}
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- End Responsive -->
</div>


{% endif %}



{% if help_form %}
<div class="card p-4 shadow-lg border-0 rounded-3 mt-4"
    style="max-width:700px; margin:auto; border-top:5px solid #007777;">
    <h4 class="mb-3" style="color:#007777;">Help & Support</h4>

    <form action="{% url 'help_section' %}" method="post">
        {% csrf_token %}
        <div class="mb-3">
            <label class="form-label">Your Name</label>
            <input type="text" name="name" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Your Email</label>
            <input type="email" name="email" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Message</label>
            <textarea name="message" rows="4" class="form-control" required></textarea>
        </div>

        <button type="submit" class="btn btn-success px-4">Send</button>
    </form>
</div>
{% endif %}

<!-- read leter list -->
 {% if read_leter_ebooks %}
 <h1>{{msg}}</h1>
<div class="container-fluid py-3">
    <div class="d-flex flex-wrap align-items-center mb-3">
        <h4 class="mb-0"><span class="brand-text" style="color:#007777;">My Read Later</span></h4>
    </div>
    <div class="d-flex justify-content-end mb-3">
        <a href="{% url 'ebook_list_student' %}" class="btn btn-secondary">
            Back to Ebooks
        </a>
    </div>
</div>

<div class="container">
    <h3 class="mb-3" style="color:#007777;">Read Later ({{ read_later_length }})</h3>

    <!-- Responsive Table Wrapper -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle table-hover">
            <thead class="text-white" style="background-color:#007777;">
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>File</th>
                    <th>Uploaded At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for book in read_leter_ebooks %}
                <tr>
                    <td>{{ book.title }}</td>
                    <td>{{ book.description }}</td>
                    <td>
                        <a href="{{ book.file.url }}" target="_blank" class="btn btn-primary btn-sm">
                            <i class="bi bi-book"></i> Read
                        </a>
                    </td>
                    <td>{{ book.uploaded_at }}</td>
                    <td>
                        <a href="{% url 'toggle_read_later' pk=book.id %}" class="btn btn-danger btn-sm">
                            Remove
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">No ebooks in Read Later</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endif %}



{% if announcement_list %}
<div class="container py-4">
    <h2 class="mb-3" style="color:#007777;">Announcements</h2>

    <!-- Create / Edit form -->
    {% if announcement_form %}
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title" style="color:#007777;">{% if announcement_create %}Add Announcement{% else %}Edit Announcement{% endif %}</h5>
            <form method="POST">
                {% csrf_token %}
                <div class="mb-3">
                    {{ announcement_form.title.label_tag }}
                    {{ announcement_form.title }}
                    {% if announcement_form.title.errors %}
                        <div class="text-danger">{{ announcement_form.title.errors }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    {{ announcement_form.content.label_tag }}
                    {{ announcement_form.content }}
                    {% if announcement_form.content.errors %}
                        <div class="text-danger">{{ announcement_form.content.errors }}</div>
                    {% endif %}
                </div>
                <button type="submit" class="btn" style="background:#007777; color:white;">
                    {% if announcement_create %}Create{% else %}Update{% endif %}
                </button>
                <a href="{% url 'announcement_list' %}" class="btn btn-secondary">Cancel</a>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- Announcement list -->
    <div class="list-group">
        {% for ann in announcements %}
        <div class="list-group-item mb-2 shadow-sm">
            <h5 style="color:#007777;">{{ ann.title }}</h5>
            <p>{{ ann.content }}</p>
            <small>on {{ ann.created_at|date:"d M Y H:i" }}</small>
            
        
        </div>
        {% empty %}
        <p>No announcements yet.</p>
        {% endfor %}
    </div>
</div>

{% endif %}



{% if notice_list %}
<div class="card shadow p-3 rounded-3 mt-3">
    <h5 class="mb-3" style="color:#007777;">Notices</h5>



    <ul class="list-group">
        {% for n in notices %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <strong>{{ n.title }}</strong><br>
                <small>{{ n.description }}</small><br>
                <span class="text-muted small">{{ n.created_at }}</span>
            </div>
            
        </li>
        {% empty %}
        <li class="list-group-item">No notices available.</li>
        {% endfor %}
    </ul>
</div>
{% endif %}


{% endblock %}